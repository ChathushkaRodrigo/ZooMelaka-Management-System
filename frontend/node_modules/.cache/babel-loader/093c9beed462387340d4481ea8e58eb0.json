{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ResourceStore = undefined;\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _Feature = require('./Feature');\n\nvar _Feature2 = _interopRequireDefault(_Feature);\n\nvar _Proxy = require('./Proxy');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar ResourceLoader = function () {\n  function ResourceLoader(options, logger, window) {\n    _classCallCheck(this, ResourceLoader);\n\n    this.options = options;\n    this._window = window;\n    this.origin = this.getOrigin(window.location.href);\n    this.cache = {};\n    this.logger = logger;\n    this._index = 0;\n  }\n\n  _createClass(ResourceLoader, [{\n    key: 'loadImage',\n    value: function loadImage(src) {\n      var _this = this;\n\n      if (this.hasResourceInCache(src)) {\n        return src;\n      }\n\n      if (isBlobImage(src)) {\n        this.cache[src] = _loadImage(src, this.options.imageTimeout || 0);\n        return src;\n      }\n\n      if (!isSVG(src) || _Feature2.default.SUPPORT_SVG_DRAWING) {\n        if (this.options.allowTaint === true || isInlineImage(src) || this.isSameOrigin(src)) {\n          return this.addImage(src, src, false);\n        } else if (!this.isSameOrigin(src)) {\n          if (typeof this.options.proxy === 'string') {\n            this.cache[src] = (0, _Proxy.Proxy)(src, this.options).then(function (src) {\n              return _loadImage(src, _this.options.imageTimeout || 0);\n            });\n            return src;\n          } else if (this.options.useCORS === true && _Feature2.default.SUPPORT_CORS_IMAGES) {\n            return this.addImage(src, src, true);\n          }\n        }\n      }\n    }\n  }, {\n    key: 'inlineImage',\n    value: function inlineImage(src) {\n      var _this2 = this;\n\n      if (isInlineImage(src)) {\n        return _loadImage(src, this.options.imageTimeout || 0);\n      }\n\n      if (this.hasResourceInCache(src)) {\n        return this.cache[src];\n      }\n\n      if (!this.isSameOrigin(src) && typeof this.options.proxy === 'string') {\n        return this.cache[src] = (0, _Proxy.Proxy)(src, this.options).then(function (src) {\n          return _loadImage(src, _this2.options.imageTimeout || 0);\n        });\n      }\n\n      return this.xhrImage(src);\n    }\n  }, {\n    key: 'xhrImage',\n    value: function xhrImage(src) {\n      var _this3 = this;\n\n      this.cache[src] = new Promise(function (resolve, reject) {\n        var xhr = new XMLHttpRequest();\n\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            if (xhr.status !== 200) {\n              reject('Failed to fetch image ' + src.substring(0, 256) + ' with status code ' + xhr.status);\n            } else {\n              var reader = new FileReader();\n              reader.addEventListener('load', function () {\n                // $FlowFixMe\n                var result = reader.result;\n                resolve(result);\n              }, false);\n              reader.addEventListener('error', function (e) {\n                return reject(e);\n              }, false);\n              reader.readAsDataURL(xhr.response);\n            }\n          }\n        };\n\n        xhr.responseType = 'blob';\n\n        if (_this3.options.imageTimeout) {\n          var timeout = _this3.options.imageTimeout;\n          xhr.timeout = timeout;\n\n          xhr.ontimeout = function () {\n            return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) fetching ' + src.substring(0, 256) : '');\n          };\n        }\n\n        xhr.open('GET', src, true);\n        xhr.send();\n      }).then(function (src) {\n        return _loadImage(src, _this3.options.imageTimeout || 0);\n      });\n      return this.cache[src];\n    }\n  }, {\n    key: 'loadCanvas',\n    value: function loadCanvas(node) {\n      var key = String(this._index++);\n      this.cache[key] = Promise.resolve(node);\n      return key;\n    }\n  }, {\n    key: 'hasResourceInCache',\n    value: function hasResourceInCache(key) {\n      return typeof this.cache[key] !== 'undefined';\n    }\n  }, {\n    key: 'addImage',\n    value: function addImage(key, src, useCORS) {\n      var _this4 = this;\n\n      if (process.env.NODE_ENV !== 'production') {\n        this.logger.log('Added image ' + key.substring(0, 256));\n      }\n\n      var imageLoadHandler = function imageLoadHandler(supportsDataImages) {\n        return new Promise(function (resolve, reject) {\n          var img = new Image();\n\n          img.onload = function () {\n            return resolve(img);\n          }; //ios safari 10.3 taints canvas with data urls unless crossOrigin is set to anonymous\n\n\n          if (!supportsDataImages || useCORS) {\n            img.crossOrigin = 'anonymous';\n          }\n\n          img.onerror = reject;\n          img.src = src;\n\n          if (img.complete === true) {\n            // Inline XML images may fail to parse, throwing an Error later on\n            setTimeout(function () {\n              resolve(img);\n            }, 500);\n          }\n\n          if (_this4.options.imageTimeout) {\n            var timeout = _this4.options.imageTimeout;\n            setTimeout(function () {\n              return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) fetching ' + src.substring(0, 256) : '');\n            }, timeout);\n          }\n        });\n      };\n\n      this.cache[key] = isInlineBase64Image(src) && !isSVG(src) ? // $FlowFixMe\n      _Feature2.default.SUPPORT_BASE64_DRAWING(src).then(imageLoadHandler) : imageLoadHandler(true);\n      return key;\n    }\n  }, {\n    key: 'isSameOrigin',\n    value: function isSameOrigin(url) {\n      return this.getOrigin(url) === this.origin;\n    }\n  }, {\n    key: 'getOrigin',\n    value: function getOrigin(url) {\n      var link = this._link || (this._link = this._window.document.createElement('a'));\n\n      link.href = url;\n      link.href = link.href; // IE9, LOL! - http://jsfiddle.net/niklasvh/2e48b/\n\n      return link.protocol + link.hostname + link.port;\n    }\n  }, {\n    key: 'ready',\n    value: function ready() {\n      var _this5 = this;\n\n      var keys = Object.keys(this.cache);\n      var values = keys.map(function (str) {\n        return _this5.cache[str].catch(function (e) {\n          if (process.env.NODE_ENV !== 'production') {\n            _this5.logger.log('Unable to load image', e);\n          }\n\n          return null;\n        });\n      });\n      return Promise.all(values).then(function (images) {\n        if (process.env.NODE_ENV !== 'production') {\n          _this5.logger.log('Finished loading ' + images.length + ' images', images);\n        }\n\n        return new ResourceStore(keys, images);\n      });\n    }\n  }]);\n\n  return ResourceLoader;\n}();\n\nexports.default = ResourceLoader;\n\nvar ResourceStore = exports.ResourceStore = function () {\n  function ResourceStore(keys, resources) {\n    _classCallCheck(this, ResourceStore);\n\n    this._keys = keys;\n    this._resources = resources;\n  }\n\n  _createClass(ResourceStore, [{\n    key: 'get',\n    value: function get(key) {\n      var index = this._keys.indexOf(key);\n\n      return index === -1 ? null : this._resources[index];\n    }\n  }]);\n\n  return ResourceStore;\n}();\n\nvar INLINE_SVG = /^data:image\\/svg\\+xml/i;\nvar INLINE_BASE64 = /^data:image\\/.*;base64,/i;\nvar INLINE_IMG = /^data:image\\/.*/i;\n\nvar isInlineImage = function isInlineImage(src) {\n  return INLINE_IMG.test(src);\n};\n\nvar isInlineBase64Image = function isInlineBase64Image(src) {\n  return INLINE_BASE64.test(src);\n};\n\nvar isBlobImage = function isBlobImage(src) {\n  return src.substr(0, 4) === 'blob';\n};\n\nvar isSVG = function isSVG(src) {\n  return src.substr(-3).toLowerCase() === 'svg' || INLINE_SVG.test(src);\n};\n\nvar _loadImage = function _loadImage(src, timeout) {\n  return new Promise(function (resolve, reject) {\n    var img = new Image();\n\n    img.onload = function () {\n      return resolve(img);\n    };\n\n    img.onerror = reject;\n    img.src = src;\n\n    if (img.complete === true) {\n      // Inline XML images may fail to parse, throwing an Error later on\n      setTimeout(function () {\n        resolve(img);\n      }, 500);\n    }\n\n    if (timeout) {\n      setTimeout(function () {\n        return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) loading image' : '');\n      }, timeout);\n    }\n  });\n};","map":{"version":3,"sources":["/Users/ChathushkaRodrigo/Desktop/ITP Project/ZooMelaka-Management-System/frontend/node_modules/react-to-pdf/node_modules/html2canvas/dist/npm/ResourceLoader.js"],"names":["Object","defineProperty","exports","value","ResourceStore","undefined","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_Feature","require","_Feature2","_interopRequireDefault","_Proxy","obj","__esModule","default","_classCallCheck","instance","TypeError","ResourceLoader","options","logger","window","_window","origin","getOrigin","location","href","cache","_index","loadImage","src","_this","hasResourceInCache","isBlobImage","_loadImage","imageTimeout","isSVG","SUPPORT_SVG_DRAWING","allowTaint","isInlineImage","isSameOrigin","addImage","proxy","Proxy","then","useCORS","SUPPORT_CORS_IMAGES","inlineImage","_this2","xhrImage","_this3","Promise","resolve","reject","xhr","XMLHttpRequest","onreadystatechange","readyState","status","substring","reader","FileReader","addEventListener","result","e","readAsDataURL","response","responseType","timeout","ontimeout","process","env","NODE_ENV","open","send","loadCanvas","node","String","_this4","log","imageLoadHandler","supportsDataImages","img","Image","onload","crossOrigin","onerror","complete","setTimeout","isInlineBase64Image","SUPPORT_BASE64_DRAWING","url","link","_link","document","createElement","protocol","hostname","port","ready","_this5","keys","values","map","str","catch","all","images","resources","_keys","_resources","get","index","indexOf","INLINE_SVG","INLINE_BASE64","INLINE_IMG","test","substr","toLowerCase"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.ResourceStore = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Feature = require('./Feature');\n\nvar _Feature2 = _interopRequireDefault(_Feature);\n\nvar _Proxy = require('./Proxy');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ResourceLoader = function () {\n    function ResourceLoader(options, logger, window) {\n        _classCallCheck(this, ResourceLoader);\n\n        this.options = options;\n        this._window = window;\n        this.origin = this.getOrigin(window.location.href);\n        this.cache = {};\n        this.logger = logger;\n        this._index = 0;\n    }\n\n    _createClass(ResourceLoader, [{\n        key: 'loadImage',\n        value: function loadImage(src) {\n            var _this = this;\n\n            if (this.hasResourceInCache(src)) {\n                return src;\n            }\n            if (isBlobImage(src)) {\n                this.cache[src] = _loadImage(src, this.options.imageTimeout || 0);\n                return src;\n            }\n\n            if (!isSVG(src) || _Feature2.default.SUPPORT_SVG_DRAWING) {\n                if (this.options.allowTaint === true || isInlineImage(src) || this.isSameOrigin(src)) {\n                    return this.addImage(src, src, false);\n                } else if (!this.isSameOrigin(src)) {\n                    if (typeof this.options.proxy === 'string') {\n                        this.cache[src] = (0, _Proxy.Proxy)(src, this.options).then(function (src) {\n                            return _loadImage(src, _this.options.imageTimeout || 0);\n                        });\n                        return src;\n                    } else if (this.options.useCORS === true && _Feature2.default.SUPPORT_CORS_IMAGES) {\n                        return this.addImage(src, src, true);\n                    }\n                }\n            }\n        }\n    }, {\n        key: 'inlineImage',\n        value: function inlineImage(src) {\n            var _this2 = this;\n\n            if (isInlineImage(src)) {\n                return _loadImage(src, this.options.imageTimeout || 0);\n            }\n            if (this.hasResourceInCache(src)) {\n                return this.cache[src];\n            }\n            if (!this.isSameOrigin(src) && typeof this.options.proxy === 'string') {\n                return this.cache[src] = (0, _Proxy.Proxy)(src, this.options).then(function (src) {\n                    return _loadImage(src, _this2.options.imageTimeout || 0);\n                });\n            }\n\n            return this.xhrImage(src);\n        }\n    }, {\n        key: 'xhrImage',\n        value: function xhrImage(src) {\n            var _this3 = this;\n\n            this.cache[src] = new Promise(function (resolve, reject) {\n                var xhr = new XMLHttpRequest();\n                xhr.onreadystatechange = function () {\n                    if (xhr.readyState === 4) {\n                        if (xhr.status !== 200) {\n                            reject('Failed to fetch image ' + src.substring(0, 256) + ' with status code ' + xhr.status);\n                        } else {\n                            var reader = new FileReader();\n                            reader.addEventListener('load', function () {\n                                // $FlowFixMe\n                                var result = reader.result;\n                                resolve(result);\n                            }, false);\n                            reader.addEventListener('error', function (e) {\n                                return reject(e);\n                            }, false);\n                            reader.readAsDataURL(xhr.response);\n                        }\n                    }\n                };\n                xhr.responseType = 'blob';\n                if (_this3.options.imageTimeout) {\n                    var timeout = _this3.options.imageTimeout;\n                    xhr.timeout = timeout;\n                    xhr.ontimeout = function () {\n                        return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) fetching ' + src.substring(0, 256) : '');\n                    };\n                }\n                xhr.open('GET', src, true);\n                xhr.send();\n            }).then(function (src) {\n                return _loadImage(src, _this3.options.imageTimeout || 0);\n            });\n\n            return this.cache[src];\n        }\n    }, {\n        key: 'loadCanvas',\n        value: function loadCanvas(node) {\n            var key = String(this._index++);\n            this.cache[key] = Promise.resolve(node);\n            return key;\n        }\n    }, {\n        key: 'hasResourceInCache',\n        value: function hasResourceInCache(key) {\n            return typeof this.cache[key] !== 'undefined';\n        }\n    }, {\n        key: 'addImage',\n        value: function addImage(key, src, useCORS) {\n            var _this4 = this;\n\n            if (process.env.NODE_ENV !== 'production') {\n                this.logger.log('Added image ' + key.substring(0, 256));\n            }\n\n            var imageLoadHandler = function imageLoadHandler(supportsDataImages) {\n                return new Promise(function (resolve, reject) {\n                    var img = new Image();\n                    img.onload = function () {\n                        return resolve(img);\n                    };\n                    //ios safari 10.3 taints canvas with data urls unless crossOrigin is set to anonymous\n                    if (!supportsDataImages || useCORS) {\n                        img.crossOrigin = 'anonymous';\n                    }\n\n                    img.onerror = reject;\n                    img.src = src;\n                    if (img.complete === true) {\n                        // Inline XML images may fail to parse, throwing an Error later on\n                        setTimeout(function () {\n                            resolve(img);\n                        }, 500);\n                    }\n                    if (_this4.options.imageTimeout) {\n                        var timeout = _this4.options.imageTimeout;\n                        setTimeout(function () {\n                            return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) fetching ' + src.substring(0, 256) : '');\n                        }, timeout);\n                    }\n                });\n            };\n\n            this.cache[key] = isInlineBase64Image(src) && !isSVG(src) ? // $FlowFixMe\n            _Feature2.default.SUPPORT_BASE64_DRAWING(src).then(imageLoadHandler) : imageLoadHandler(true);\n            return key;\n        }\n    }, {\n        key: 'isSameOrigin',\n        value: function isSameOrigin(url) {\n            return this.getOrigin(url) === this.origin;\n        }\n    }, {\n        key: 'getOrigin',\n        value: function getOrigin(url) {\n            var link = this._link || (this._link = this._window.document.createElement('a'));\n            link.href = url;\n            link.href = link.href; // IE9, LOL! - http://jsfiddle.net/niklasvh/2e48b/\n            return link.protocol + link.hostname + link.port;\n        }\n    }, {\n        key: 'ready',\n        value: function ready() {\n            var _this5 = this;\n\n            var keys = Object.keys(this.cache);\n            var values = keys.map(function (str) {\n                return _this5.cache[str].catch(function (e) {\n                    if (process.env.NODE_ENV !== 'production') {\n                        _this5.logger.log('Unable to load image', e);\n                    }\n                    return null;\n                });\n            });\n            return Promise.all(values).then(function (images) {\n                if (process.env.NODE_ENV !== 'production') {\n                    _this5.logger.log('Finished loading ' + images.length + ' images', images);\n                }\n                return new ResourceStore(keys, images);\n            });\n        }\n    }]);\n\n    return ResourceLoader;\n}();\n\nexports.default = ResourceLoader;\n\nvar ResourceStore = exports.ResourceStore = function () {\n    function ResourceStore(keys, resources) {\n        _classCallCheck(this, ResourceStore);\n\n        this._keys = keys;\n        this._resources = resources;\n    }\n\n    _createClass(ResourceStore, [{\n        key: 'get',\n        value: function get(key) {\n            var index = this._keys.indexOf(key);\n            return index === -1 ? null : this._resources[index];\n        }\n    }]);\n\n    return ResourceStore;\n}();\n\nvar INLINE_SVG = /^data:image\\/svg\\+xml/i;\nvar INLINE_BASE64 = /^data:image\\/.*;base64,/i;\nvar INLINE_IMG = /^data:image\\/.*/i;\n\nvar isInlineImage = function isInlineImage(src) {\n    return INLINE_IMG.test(src);\n};\nvar isInlineBase64Image = function isInlineBase64Image(src) {\n    return INLINE_BASE64.test(src);\n};\nvar isBlobImage = function isBlobImage(src) {\n    return src.substr(0, 4) === 'blob';\n};\n\nvar isSVG = function isSVG(src) {\n    return src.substr(-3).toLowerCase() === 'svg' || INLINE_SVG.test(src);\n};\n\nvar _loadImage = function _loadImage(src, timeout) {\n    return new Promise(function (resolve, reject) {\n        var img = new Image();\n        img.onload = function () {\n            return resolve(img);\n        };\n        img.onerror = reject;\n        img.src = src;\n        if (img.complete === true) {\n            // Inline XML images may fail to parse, throwing an Error later on\n            setTimeout(function () {\n                resolve(img);\n            }, 500);\n        }\n        if (timeout) {\n            setTimeout(function () {\n                return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) loading image' : '');\n            }, timeout);\n        }\n    });\n};"]},"metadata":{},"sourceType":"script"}